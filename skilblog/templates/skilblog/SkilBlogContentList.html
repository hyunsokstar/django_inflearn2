{% extends "layout.html" %}
{%block title %}스킬 블로그(상세 보기){% endblock %}

{%block content2 %}
<div class="jumbotron">
    <h2>{{title}}</h2>
</div>

{% if messages %}
<div class="alert alert-success">
    {% for message in messages %}
     {{ message.message }}<strong>{{ message.tags }}</strong>
     {% endfor %}
</div>
{% endif %}
<!-- <a href="/bestlec/new/" class="btn btn-danger float-right">입력 </a> -->

<!-- 2244
cjs -->

<!-- <a class="new3_btn btn btn-outline-success float-right" id="" href="/wm/new/textarea_summer_note">SN</a> -->
<a class="new3_btn btn btn-outline-success float-right" id="" href="/skilblog/new/summernote/{{skil_blog_title_id}}">SN</a>

{% if sbc.exists %}
{% for p in sbc %}
<table class="table table-bordered table_row" id="todo_list">

	{% ifequal p.type.type_name "input" %}

	<!-- 2244 -->
	<tr id="shortcut_{{p.id}}" style="background-color:#f1f9f0;">
		<td id=index_{{ forloop.counter }} width="10%">
			<input type="checkbox" id="{{p.pk}}" class="shortcut_check">
			{{ forloop.counter }}
		</td>
		<td>
			<span id=title_{{p.id}}>
				{{p.title}}
			</span>
			{% if p.author == request.user %}
				<button class="badge badge-pill badge-primary sbc_delete_btn float-right" id="{{p.id}}">삭제</button>
				<button class="badge badge-pill badge-primary sbc_modify_btn float-right" id="{{p.id}}">제목 수정</button>
			{% endif %}
		</td>
	</tr>

	<tr id="shortcut_{{p.id}}-2" style="background-color:#f0f1f5">
		<td colspan="2">
			<input type="text" name="" value="{{p.content1}}" size="40" id="select-input-{{p.id}}" class="form-control">
			<button class="btn btn-outline-danger btn-sm myinput float-right copy_code1" id="{{p.id}}">copy</button>
			<button class="btn btn-outline-danger btn-sm float-right edit_skil_blog_for_content1_btn" id="{{p.id}}">edit_complete</button>
			<button class="btn btn-outline-danger btn-sm shortcut_comment_button" id="{{p.id}}">댓글 추가</button>
		</td>
	</tr>
	{% endifequal %}

	{% ifequal p.type.type_name "textarea" %}
	<tr id="shortcut_{{p.id}}" style="background-color:#f1f9f0">
		<td id=index_{{ forloop.counter }} width="10%">
			<input type="checkbox" id="{{p.pk}}" class="shortcut_check">
			{{ forloop.counter }}
		</td>
		<td>
			<span id=title_{{p.id}}>{{p.title}}</span>
			{% if p.author == request.user %}
			<button class="badge badge-pill badge-primary sbc_delete_btn float-right" id="{{p.id}}">삭제</button>
			<button class="badge badge-pill badge-primary sbc_modify_btn float-right" id="{{p.id}}">제목 수정</button>

			{% endif %}
		</td>
	</tr>
	<tr id="shortcut_{{p.id}}-2" style="background-color:#f0f1f5">
		<td colspan="2">
			<button class="btn btn-outline-primary btn-sm show_total_textInput_button" id={{p.id}}>24row</button>
			<button class="btn btn-outline-primary btn-sm show_basic_textInput_button" id={{p.id}}>8row</button>
			<button class="btn btn-outline-primary btn-sm show_text_popup_button" id={{p.id}}>popup</button>

			<textarea id="select-textarea-{{p.id}}" cols="120" rows="10"
				class="form-control">{{p.content2 }}</textarea><br>
			<button class="btn btn-outline-danger btn-sm myinput float-right copy_code2 float-right"
				id="{{p.id}}">copy</button>
			<button class="btn btn-outline-danger btn-sm float-right edit_skil_blog_for_content2_btn float-right"
				id="{{p.id}}" data-user_id="{{request.user}}">edit_complete</button>
			<button class="btn btn-outline-danger btn-sm shortcut_comment_button" id="{{p.id}}">댓글 추가</button>
		</td>
	</tr>
	{% endifequal %}

	{% ifequal p.type.type_name "summer_note" %}
	<tr id="shortcut_{{p.id}}" style="background-color:#f1f9f0">
		<td id=index_{{ forloop.counter }} width="10%">
			<input type="checkbox" id="{{p.pk}}" class="shortcut_check">
			{{ forloop.counter }}
		</td>
		<td width="90%">
			<span id=title_{{p.id}}>{{p.title}}</span>
			{% if p.author == request.user %}
			<button class="badge badge-pill badge-primary sbc_delete_btn float-right" id="{{p.id}}">삭제</button>
			<button class="badge badge-pill badge-primary sbc_modify_btn float-right" id="{{p.id}}">제목 수정</button>
			{% endif %}
		</td>
	</tr>

	<tr id="shortcut_{{p.id}}-2" style="background-color:#f0f1f5">
		<td colspan="2">

				<span id="select-textarea-{{p.id}}" style="width:900px; background-color:white;" contenteditable="true">
					{{p.content2 | safe}}
				</span>

			<br>
			<button class="btn btn-outline-danger btn-sm shortcut_comment_button" id="{{p.id}}">댓글 추가</button>
			<button class="btn btn-outline-danger btn-sm myinput float-right copy_code2" id="{{p.id}}">copy</button>
			<!-- <a href="{% url "wm:modify_myshortcut_by_summer_note" p.id %}"
				class="btn btn-outline-danger float-right btn-sm">summernote 수정</a> -->
            <a href={% url "skilblog:modify_skilblog_content2_by_summernote" p.pk %} class="btn btn-outline-danger float-right btn-sm">summernote 수정 22</a>
		</td>
	</tr>
	{% endifequal %}

	{% ifequal p.type.type_name "input_title" %}
	<tr style="background-color:#caf5f5; color:black;" id="shortcut_{{p.id}}">
		<td id=index_{{ forloop.counter }} width="10%">
			<input type="checkbox" id="{{p.pk}}" class="shortcut_check">
			{{ forloop.counter }}
		</td>
		<td>
			제목 :
			<span id=title_{{p.id}}>{{p.title}}</span>
			{% if p.author == request.user %}
			<button class="badge badge-pill badge-primary sbc_delete_btn float-right" id="{{p.id}}">삭제</button>
			<button class="badge badge-pill badge-primary sbc_modify_btn float-right" id="{{p.id}}">제목 수정</button>
			{% endif %}
		</td>
	</tr>
	<tr id="shortcut_{{p.id}}-2" style="background-color:#f0f1f5;">
		<td colspan="2">
			<textarea id="select-textarea-{{p.id}}" cols="120" rows="10"
				class="form-control">{{p.content2 }}</textarea><br>
			<button class="btn btn-outline-danger btn-sm myinput float-right copy_code2" id="{{p.id}}">copy</button>
			<button class="btn btn-outline-danger btn-sm float-right shortcut_edit_button2"
				id="{{p.id}}">edit_complete</button> 2244
			<button class="btn btn-outline-danger btn-sm shortcut_comment_button" id="{{p.id}}">댓글 추가</button>
		</td>
	</tr>
	{% endifequal %}

</table>

{% endfor %}
{% else %}

<table class="table table-bordered">
	<tr>
		<td colspan="4" background-color="skyblue">
			<h4>there is no article</h4>
		</td>
	</tr>
</table>
{% endif %}

{%endblock%}

<!-- js area -->
<script type="text/javascript">
{% block extra_js %}

$('body').on('click', '.copy_code1', function (e) {

	e.preventDefault();
	var id = this.id

	document.execCommand('copy', false, $(this).parent().find('#select-input-' + id).select());
	alert("copy is completed")
});

$('body').on('click', '.copy_code2', function (e) {
	e.preventDefault();
	var id = this.id
	// alert(id)
	document.execCommand('copy', false, $(this).parent().find('#select-textarea-' + id).select());
	alert("copy is completed")
});

$('body').on('click', '.edit_skil_blog_for_content2_btn', function (e) {
    e.preventDefault();
    var id = $(this).attr("id");
    var content2 = $("#select-textarea-"+id).val();
    console.log("content2 for update : " +content2)

    $.ajax({
        type: "POST",
        url: '/skilblog/edit_skil_blog_for_content2/' + id,
        data: {
            id: id,
            content2: content2,
            csrfmiddlewaretoken: '{{ csrf_token }}'
        },
        success: function (result) {
            alert("message : " +result.message)
        }
    });
});


$('body').on('click', '.edit_skil_blog_for_content1_btn', function (e) {
	e.preventDefault();
	var id = $(this).attr("id");
	const content1 = $("#select-input-" + id).val();

	$.ajax({
		type: "POST",
		url: '/skilblog/edit_skil_blog_for_content1/'+id,
		data: {
			id: id,
			content1: content1,
			csrfmiddlewaretoken: '{{ csrf_token }}'
		},
		success: function (result) {
			alert("modify is completted")
		}
	});
});

$('body').on('click', '.sbc_delete_btn', function (e) {

	e.preventDefault();
	var id = $(this).attr("id");

	$.ajax({
		type: "POST",
		url: '/skilblog/delete_sbc_content/' + id,
		data: {
			csrfmiddlewaretoken: '{{ csrf_token }}'
		},
		success: function (result) {
            alert("message 확인 : " + result.message);
			$("#shortcut_" + id).remove();
			$("#shortcut_" + id + "-2").remove();
		}
	});
});

$('body').on('click', '.sbc_modify_btn', function (e) {

	e.preventDefault();
	var id = $(this).attr("id");
	const before_title = $("#title_"+id).text().trim()
    // console.log("sbc_modify_btn 클릭");
    // console.log("id : " , id);

	const title = prompt("title을 입력해 주세요 ", before_title);

	if (!title) {
		return;
	};

	$.ajax({
		type: "POST",
    	url: '/skilblog/sbc_title_modify/' + id,
		data: {
			title: title,
			csrfmiddlewaretoken: '{{ csrf_token }}'
		},
		success: function (result) {
			$("#title_" + id).text(result.title)
			alert(result.message);
		}
	});

});


{% endblock %}
</script>
