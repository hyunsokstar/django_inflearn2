{% extends "layout.html" %}
{% load staticfiles %}

{%block title %}todo list{% endblock %}

{%block extra_css %}

button, input, a {
    margin-bottom:5px;
}

.sideicon_for_scroll{
    position:fixed;
    colort:blue;
    top:60px;
    right:16px;
}

.sideicon_for_insert{
    position:fixed;
    colort:blue;
    top:290px;
    right:16px;
}

.category_btn{
    position:fixed;
    colort:blue;
    top:450px;
    right:16px;
}

.category_user_btn{
    position:fixed;
    colort:blue;
    top:490px;
    right:16px;
}

.go_to_before_channer_btn{
    position:fixed;
    colort:blue;
    top:530px;
    right:16px;
}

.go_to_next_channer_btn{
    position:fixed;
    colort:blue;
    top:580px;
    right:16px;
}

{% endblock %}


{%block content4 %}

<!-- <div class="jumbotron"> -->
<br>
<hr>
    <h2>Skil Note by {{request.user.profile.shortcut_user_id}}</h2>
    <input type="text" name="" value="{{request.user.profile.shortcut_user_id}}" id="shortcut_user_id">
    <button type="button" class="update_shortcut_user_id" id="{{request.user.id}}">id 수정</button>
    <button type="button" class="user_list_btn">유저 목록</button>
    <button type="button" class="category_name_list_button" id="{{request.user.id}}">카테고리</button>
<hr>


<!-- </div> -->

{% if messages %}
<div class="alert alert-success">
    {% for message in messages %}
     {{ message.message }}<strong>{{ message.tags }}</strong>
     {% endfor %}
</div>
{% endif %}


<table width="100%">
    <tr>
        <td>
            {% for category in category_list %}
                {% ifequal category.id request.user.profile.selected_category_id %}
                    <a style="background-color:yellow" class="btn btn-outline-info btn-sm ca-btn-selected" href="{{category.get_absolute_url}}" id={{category.id}}>{{ category.name }} </a>
                {% else %}
                    <a class="btn btn-outline-info btn-sm ca-btn-{{category.id}} ca-btn" id=ca_{{category.id}} href="{{category.get_absolute_url}}">{{ category.name }} </a>
                {% endifequal %}
            {% endfor %}

        </td>
    </tr>
</table>

{% ifequal request.user.profile.shortcut_user_id request.user.username %}

    <a href="" class="btn btn-outline-primary float-left" id="shortcut_delete_button"> 삭제(ch) </a>
    <a href="" class="btn btn-outline-primary float-left" id="modify_category_button"> 이동(ch) </a>

    <a href="{% url "wm:insert_myshortcut_textarea_summer_note" %}" class="btn btn-outline-success float-right">SummerNote</a>
    <a href="{% url "wm:insert_myshortcut_input_title" %}" class="btn btn-outline-success float-right">Title</a>
    <a href="{% url "wm:insert_myshortcut_textarea" %}" class="btn btn-outline-success float-right">TextArea</a>
    <a href="{% url "wm:insert_myshortcut_input" %}" class="btn btn-outline-success float-right">InputBox</a>

{% else %}

<span class="float-right"> {{request.user.profile.shortcut_user_id}} 님만 입력할수 있습니다. </span>
{% endifequal %}

<div class="sideicon_for_scroll">
    <button type="button" name="button" class="go_start_line_btn btn btn-outline-success" id="">first</button><br>
    <button type="button" name="button" class="go_end_line_btn btn btn-outline-success" id="">end</button><br>
    <input type="text" class="go_input form" size=2 value="1"><br>
    <button type="button" name="button" class="go_btn btn btn-outline-success" id="">Go</button><br>
    <button type="button" name="button" class="before_btn btn btn-outline-success" id="">before</button><br>
    <button type="button" name="button" class="next_btn btn btn-outline-success" id="">next</button>
</div>

<div class="sideicon_for_insert">
    <a class="new3_btn btn btn-outline-success" id="" href="{% url 'wm:insert_myshortcut_textarea_summer_note' %}">SN</a><br>
    <button type="button" name="button" class="new1_btn btn btn-outline-success" id="">input</button><br>
    <button type="button" name="button" class="new2_btn btn btn-outline-success" id="">text(1)</button><br>
    <a class="new4_btn btn btn-outline-success" id="" href=""> text(5) </a>
</div>

<button type="button" class="category_btn category_name_list_button btn btn-outline-success" id="{{request.user.id}}">CH</button>
<button type="button" class="category_user_btn user_list_btn btn btn-outline-success" >User</button>

<button type="button" class="go_to_before_channer_btn btn btn-outline-success" >
    <img src="{% static 'icon/left_arrow.png' %}" alt="" >
</button>

<button type="button" class="go_to_next_channer_btn btn btn-outline-success" >
    <img src="{% static 'icon/right_arrow.png' %}" alt="" >
</button>



<button type="button" name="button" id="index_first" hidden></button>
<br><br>

{% if category %}
    <h2 > <span id="current_category">{{category}}</span> : {{category_nick}}</h2>
{% endif %}

    {% if object_list.exists %}
        {% for p in object_list %}
            <table class="table table-bordered table_row" id="todo_list" width="100%">

            {% ifequal p.type.type_name "input" %}
            <tr id="shortcut_{{p.id}}">
                <td id=index_{{ forloop.counter }} width="10%">
                    <input type="checkbox" id="{{p.pk}}" class="shortcut_check" >
                        {{ forloop.counter }}
                </td>
                <td>
                    <span id=title_{{p.id}}>
                        {{p.title}}
                    </span>
                    {% if p.author == request.user %}
                    <button class="badge badge-pill badge-primary short_delete_button float-right" id="{{p.id}}">삭제</button>
                    <button class="badge badge-pill badge-primary short_update_button float-right" id="{{p.id}}">제목 수정</button>
                    <!-- <img src="{% static 'icon/trashcan.png' %}" alt="" > -->

                    {% endif %}
                </td>
            </tr>

            <tr id="shortcut_{{p.id}}-2">
                <td colspan="2">
                    <input type="text" name="" value="{{p.content1}}" size="40" id="select-input-{{p.id}}" class="form-control">
                    <button class="btn btn-outline-danger btn-sm myinput float-right copy_code1" id="{{p.id}}">copy</button>
                    <button class="btn btn-outline-danger btn-sm float-right shortcut_edit_button1" id="{{p.id}}" >edit_complete</button>
                    <button class="btn btn-outline-danger btn-sm shortcut_comment_button" id="{{p.id}}" >댓글 추가</button>
                </td>
            </tr>
            {% endifequal %}

            {% ifequal p.type.type_name "textarea" %}
            <tr id="shortcut_{{p.id}}" style="background-color:#f1f9f0">
                <td id=index_{{ forloop.counter }} width="10%">
                    <input type="checkbox" id="{{p.pk}}" class="shortcut_check">
                    {{ forloop.counter }}
                </td>
                <td >
                    <span id=title_{{p.id}}>{{p.title}}</span>
                    {% if p.author == request.user %}
                    <button class="badge badge-pill badge-primary short_delete_button float-right" id="{{p.id}}">삭제</button>
                    <button class="badge badge-pill badge-primary short_update_button float-right" id="{{p.id}}">제목 수정</button>
                    <!-- <img src="{% static 'icon/trashcan.png' %}" alt=""> -->

                    {% endif %}
                </td>
            </tr>
            <tr id="shortcut_{{p.id}}-2" style="background-color:#f7f7e4">
                <td colspan="2">
                <textarea id="select-textarea-{{p.id}}" cols="120" rows="10" class="form-control">{{p.content2 }}</textarea><br>
                <button class="btn btn-outline-danger btn-sm myinput float-right copy_code2 float-right" id="{{p.id}}">copy</button>
                <button class="btn btn-outline-danger btn-sm float-right shortcut_edit_button2 float-right" id="{{p.id}}" >edit_complete</button>
                <button class="btn btn-outline-danger btn-sm shortcut_comment_button" id="{{p.id}}" >댓글 추가</button>
                </td>
            </tr>
            {% endifequal %}

            {% ifequal p.type.type_name "summer_note" %}
            <tr id="shortcut_{{p.id}}">
                <td id=index_{{ forloop.counter }} width="10%">
                    <input type="checkbox" id="{{p.pk}}" class="shortcut_check">
                    {{ forloop.counter }}
                </td>
                <td>
                    <span id=title_{{p.id}}>{{p.title}}</span>
                    {% if p.author == request.user %}
                    <button class="badge badge-pill badge-primary short_delete_button float-right" id="{{p.id}}">삭제</button>
                    <button class="badge badge-pill badge-primary short_update_button float-right" id="{{p.id}}">제목 수정</button>
                    <!-- <img src="{% static 'icon/trashcan.png' %}" alt=""> -->
                    {% endif %}
                </td>
            </tr>

            <tr id="shortcut_{{p.id}}-2">
                <td colspan="2">
                <div id="select-textarea-{{p.id}}">{{p.content2 | safe}}</div>
                <br>
                <button class="btn btn-outline-danger btn-sm myinput float-right copy_code2" id="{{p.id}}">copy</button>
                <a href="{% url "wm:modify_myshortcut_by_summer_note" p.id %}" class="btn btn-outline-danger float-right btn-sm">summernote update</a>
                </td>
            </tr>
            {% endifequal %}

            {% ifequal p.type.type_name "input_title" %}
            <tr style="background-color:#caf5f5; color:black;" id="shortcut_{{p.id}}">
                <td id=index_{{ forloop.counter }} width="10%" >
                    <input type="checkbox" id="{{p.pk}}" class="shortcut_check">
                    {{ forloop.counter }}
                </td>
                <td >
                    제목 :
                    <span id=title_{{p.id}}>{{p.title}}</span>
                    {% if p.author == request.user %}
                    <button class="badge badge-pill badge-primary short_delete_button float-right" id="{{p.id}}">삭제</button>
                    <button class="badge badge-pill badge-primary short_update_button float-right" id="{{p.id}}">제목 수정</button>
                    {% endif %}
                </td>
            </tr>
            <tr id="shortcut_{{p.id}}-2" style="background-color:#efecf8;">
                <td colspan="2">
                <textarea id="select-textarea-{{p.id}}" cols="120" rows="10" class="form-control">{{p.content2 }}</textarea><br>
                <button class="btn btn-outline-danger btn-sm myinput float-right copy_code2" id="{{p.id}}">copy</button>
                <button class="btn btn-outline-danger btn-sm float-right shortcut_edit_button2" id="{{p.id}}" >edit_complete</button>
                <button class="btn btn-outline-danger btn-sm shortcut_comment_button" id="{{p.id}}" >댓글 추가</button>

                </td>
            </tr>
            {% endifequal %}

        </table>

        <!-- 댓글 영역 -->
        {% if p.commentforshortcut_set.exists %}
        <a class="btn btn-outline-primary btn-block " data-toggle="collapse" href="#collapseExample" role="button" aria-expanded="false" aria-controls="collapseExample" style="margin-bottom:5px">
            Comment Area ({{p.commentforshortcut_set.count}})
        </a>

            <div class="collapse" id="collapseExample">
                {% for comment in p.commentforshortcut_set.all %}
                <table class="table table-bordered" style="background-color:#17ac2d" id=comment_table_{{comment.id}}>
                    <tr>
                        <td>
                            <input type="text" name="" class="form-control" value="{{comment.title}}" id=comment_title_{{comment.id}}>
                            <button class="badge badge-pill badge-primary comment_delete_button float-right" id={{comment.id}}>댓글 삭제</button>
                            <button class="badge badge-pill badge-primary comment_update_button float-right" id={{comment.id}}>댓글 수정</button>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <textarea name="name" rows="8" cols="80" class="form-control" id=comment_content_{{comment.id}}>{{comment.content}}</textarea>
                        </td>
                    </tr>
                </table>
                {% endfor %}
            </div>
        {% endif %}

        {% endfor %}
        <span class="myshort_list_area"></span>
    {% else %}

    <table class="table table-bordered">
        <tr>
            <td colspan="4" background-color="skyblue">
                <h4>there is no article</h4>
            </td>
        </tr>
    </table>
    {% endif %}

<!-- modal area -->

<!-- category list modal  -->
<div class="modal fade" id="CategoryModal" role="dialog">
    <div class="modal-dialog modal-lg">
        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Modal Header</h4>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body category_nick_area">
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<!-- user list modal -->
  <div class="modal fade" id="user_list_modal" role="dialog">
    <div class="modal-dialog modal-lg">

      <!-- Modal content-->
      <div class="modal-content">
        <div class="modal-header">
            <h4 class="modal-title">Modal Header</h4>
            <button type="button" class="close" data-dismiss="modal">&times;</button>
        </div>
        <div class="modal-body" id="user_table_area">
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>
      </div>

    </div>
  </div>


<script class="myshortcut_row" type="text/x-template">

<table class="table table-bordered table_row" id="todo_list" width="100%">
    <tr id="shortcut_<%=shortcut_id%>">
        <td class="counter_row">
            <input type="checkbox" id="<%=shortcut_id%>" class="shortcut_check" >
                <%=table_row_id %>
        </td>
        <td>
            <%=shortcut_title%>
            <button class="badge badge-pill badge-primary short_delete_button" id="<%=shortcut_id%>">삭제</button>
        </td>
    </tr>

    <tr id="shortcut_<%=shortcut_id%>-2">
        <td colspan="2">
            <input type="text" name="" value="<%=shortcut_content%>" size="40" id="select-input-<%=shortcut_id%>" class="form-control">
            <button class="btn btn-outline-danger btn-sm myinput float-right copy_code1" id="<%=shortcut_id%>">copy</button>
            <button class="btn btn-outline-danger btn-sm float-right shortcut_edit_button1" id="<%=shortcut_id%>" >edit_complete</button>
            <button class="btn btn-outline-danger btn-sm shortcut_comment_button" id="{{p.id}}" >댓글 추가</button>
        </tr>
</table>

</script>

<script class="myshortcut_row_textarea" type="text/x-template">

<table class="table table-bordered table_row" id="todo_list" width="100%">

    <tr id="shortcut_<%=shortcut_id%>">
        <td id=index_{{ forloop.counter }}>
            <input type="checkbox" id="<%=shortcut_id%>" class="shortcut_check">
            <%=table_row_id %>
        </td>
        <td>
            <%=shortcut_title%>
            <button class="badge badge-pill badge-primary short_delete_button" id="<%=shortcut_id%>">삭제</button>
        </td>
    </tr>
    <tr id="shortcut_<%=shortcut_id%>-2">
        <td colspan="2">
        <textarea id="select-textarea-<%=shortcut_id%>" cols="120" rows="10" ><%=shortcut_content2%></textarea><br>
        <button class="btn btn-outline-danger btn-sm myinput float-right copy_code2" id="<%=shortcut_id%>">copy</button>
        <button class="btn btn-outline-danger btn-sm float-right shortcut_edit_button2" id="<%=shortcut_id%>" >edit_complete</button>
        <button class="btn btn-outline-danger btn-sm shortcut_comment_button" id="{{p.id}}" >댓글 추가</button>

        </td>
    </tr>

</script>

{% endblock %}

<script type="text/javascript">
{% block extra_js %}

$('body').on('click', '.comment_update_button', function(e) {
    // alert("댓글 제목 수정 버튼 클릭");
    const comment_id = this.id;
    const title = $("#comment_title_"+comment_id).val()
    const content = $("#comment_content_"+comment_id).val()
    // alert("title : " + title);
    // alert("content : " + content);

    window.history.pushState("", "", '/wm/')

    $.ajax({
      type: "POST",
      url: 'update_shortcut_comment_ajax/'+comment_id,
      data: {
          title:title,
          content:content,
          csrfmiddlewaretoken: '{{ csrf_token }}'
      },
        success: function(result) {
            alert(result.message);
            window.history.pushState("", "", '/wm/myshortcut/')
        }
    });
});

// comment_delete_button

$('body').on('click', '.comment_delete_button', function(e) {
    // alert("댓글 삭제 버튼 클릭");
    const comment_id = this.id;

    window.history.pushState("", "", '/wm/')

    $.ajax({
      type: "POST",
      url: 'delete_shortcut_comment_ajax/'+comment_id,
      data: {
          csrfmiddlewaretoken: '{{ csrf_token }}'
      },
        success: function(result) {
            alert(result.message);
            $("#comment_table_"+comment_id).remove()
            window.history.pushState("", "", '/wm/myshortcut/')
        }
    });
});


$('body').on('click', '.shortcut_comment_button', function(e) {
    // const option = prompt("새로운 댓글을 추가 하실래요?(x,y)","");

    const option = "y";

    const shortcut_id = this.id
    // alert("shortcut_id : " +shortcut_id)
    if (!option) {
        return;
    };

    window.history.pushState("", "", '/wm/')
    if (option == "y"){
        $.ajax({
            type: "POST",
            url: 'new_comment_for_my_shortcut/'+shortcut_id+'/ajax/',
            data: {
                shortcut_id:shortcut_id,
                csrfmiddlewaretoken: '{{ csrf_token }}'
            },
            success: function(result) {
                alert(result.message);

                window.history.pushState("", "", '/wm/myshortcut/')
                location.reload(true);
            }
        });
    }else{
        alert("입력을 취소하였습니다.")
    }
});


$(document).ready(function(){
    const user = "{{request.user}}"
    if($("#shortcut_user_id").val()== "me"){
        $("#shortcut_user_id").val(user)
        $( ".update_shortcut_user_id" ).trigger("click");
    }
})

$(".go_to_before_channer_btn").click(function(){
    // alert("클릭22");
    const category_id = parseInt($(".ca-btn-selected").attr('id'))-1
    // alert("category_id : "+ category_id)

    if(category_id < 1 ){
        category_id = 1
    }
    // var href = $('.cssbuttongo').attr('href')
    nect_ch_url = $("#ca_"+category_id).attr('href')
    window.location.href = nect_ch_url;
})

$(".go_to_next_channer_btn").click(function(){
    // alert("클릭22");
    const category_id = parseInt($(".ca-btn-selected").attr('id'))+1
    // alert("category_id : "+ category_id)

    if(category_id > 99 ){
        category_id = 99
    }

    // var href = $('.cssbuttongo').attr('href')
    nect_ch_url = $("#ca_"+category_id).attr('href')
    window.location.href = nect_ch_url;
})

$(".go_start_line_btn").click(function(){
    $(".go_input").val(1)
    $( ".go_btn" ).trigger("click");
})

$(".go_end_line_btn").click(function(){
    var row_count = $('.table_row').length;
    $(".go_input").val(row_count)
    $( ".go_btn" ).trigger("click");

})

    $(".new4_btn").click(function(){
    // alert("new2 버튼 클릭")
    window.history.pushState("", "", '/wm/myshortcut/')
    const title = prompt("textbox 5개를 만드시겠습니까? (x,y)", "");

    if (!title) {
        return;
    };

    if(title == "y" || title=="Y"){
        $.ajax({
            type: "POST",
            url: 'create_new4_textarea/ajax/',
            data: {
                csrfmiddlewaretoken: '{{ csrf_token }}'
            },
            success: function(result) {
                alert(result.message);

                // underscore를 이용해 row 추가 하기
                // var raw_template = $('.myshortcut_row_textarea').html();
                // var tpl = _.template(raw_template);
                //
                // var rendered = tpl({
                //     shortcut_id : result.shortcut_id,
                //     shortcut_title : result.shortcut_title,
                //     shortcut_content2 : result.shortcut_content2,
                // });
                // $(rendered).appendTo($('.myshort_list_area'));
                window.history.pushState("", "", '/wm/myshortcut/')
                location.reload(true);
            }
        });
    } else {
        // alert("title : ", title)
        alert("취소 하였습니다")
    }

})

$(".new1_btn").click(function(){
    // alert("new1 버튼 클릭")
    window.history.pushState("", "", '/wm/myshortcut/')
    const title = prompt("title을 입력해 주세요 ", "");

    if (!title) {
        return;
    };

    if(title != "" && title != null){
        $.ajax({
            type: "POST",
            url: 'create_new1_input/ajax/',
            data: {
                title:title,
                csrfmiddlewaretoken: '{{ csrf_token }}'
            },
            success: function(result) {
                console.log("result : " , result);
                alert("insert success")
                window.history.pushState("", "", '/wm/myshortcut/')

                var table_row = $('.table_row').length;
                // alert("table_row : "+ table_row)

                var raw_template = $('.myshortcut_row').html();
                var tpl = _.template(raw_template);

                var rendered = tpl({
                    table_row_id: table_row+1,
                    shortcut_id : result.shortcut_id,
                    shortcut_title : result.shortcut_title,
                    shortcut_content : result.shortcut_content,
                });
                $(rendered).appendTo($('.myshort_list_area'));
                // I want to scropp to bottom how to make it?
                $("html, body").animate({ scrollTop: $(document).height() }, 1000);
            }
        });
    } else{
        alert("title : ", title)
        alert('제목을 입력하지 않으셨어여 다시 시도해주세요')
        return;
    }

})

$(".new2_btn").click(function(){
    // alert("new2 버튼 클릭")
    window.history.pushState("", "", '/wm/myshortcut/')
    const title = prompt("title을 입력해 주세요 ", "");

    if (!title) {
        return;
    };

    if(title != ""){
        $.ajax({
            type: "POST",
            url: 'create_new2_textarea/ajax/',
            data: {
                title:title,
                csrfmiddlewaretoken: '{{ csrf_token }}'
            },
            success: function(result) {
                alert(result.message);

                // underscore를 이용해 row 추가 하기
                var raw_template = $('.myshortcut_row_textarea').html();
                var tpl = _.template(raw_template);
                var table_row = $('.table_row').length;

                // alert("result.shorcut_id : "+ result.shortcut_id)
                // alert("shorcut_title : "+ result.shorcut_title)
                // alert("shortcut_content2 : "+ result.shortcut_content2)

                var rendered = tpl({
                    table_row_id: table_row+1,
                    shortcut_id : result.shortcut_id,
                    shortcut_title : result.shortcut_title,
                    shortcut_content2 : result.shortcut_content2,
                });
                $(rendered).appendTo($('.myshort_list_area'));
                // location.reload(true);
                $ ("html, body"). animate ({scrollTop: $ (document) .height ()}, 1000);
                window.history.pushState("", "", '/wm/myshortcut/')

            }
        });
    } else {
        // alert("title : ", title)
        alert("제목을 입력하지 않으셨어여 다시 시도해주세요")
    }

})


$(".before_btn").click(function(){

    var number = Number($(".go_input").val());
    var number_next = number -1

    if(number_next < 1 ){
        number_next = 1
        $(".go_input").val(number)
    }

    // alert(number_next)
    $(".go_input").val(number_next)


    $( ".go_btn" ).trigger("click");

})

$(".next_btn").click(function(){

    var number = Number($(".go_input").val());
    var number_next = number + 1

    if(number < 1){
        number = 1
        $(".go_input").val(number)
    }

    // alert(number_next)
    $(".go_input").val(number_next)

    $( ".go_btn" ).trigger("click");

})

$("#modify_category_button").click(function(e){

    e.preventDefault();
    var shortcut_arr = [];

    const text = ""

    $('.shortcut_check').each(function() {
        if (jQuery(this).is(":checked")) {
            var id = this.id;
            shortcut_arr.push(id);
        }
    });
    // alert('이동할 shortcut : '+ shortcut_arr)

    var category = prompt("where do you go? (1~99)", "");

    if (category.match("^[1-9][0-9]?$")){

        if (category == null || category == "") {
          txt = "User cancelled the prompt.";
        } else {
          txt = category + "로 "  + shortcut_arr + "를 이동"
          alert("txt : " + category + "로 "  + shortcut_arr + "를 이동")
        }

        window.history.pushState("", "", '/wm/myshortcut/')

        $.ajax({
          type: "POST",
          url: 'update/category/ajax',
          data: {
              'shortcut_arr[]':shortcut_arr,
              'category':category,
              csrfmiddlewaretoken: '{{ csrf_token }}'
          },
            success: function(result) {
                alert(shortcut_arr +"을 " + category + '로 이동' );
                jQuery('input:checkbox:checked').parents("table").remove();

            }
        });

    } else {
        alert("이동할 카테고리는 1~99 중에 선택해주세요")
    }

})

$('#shortcut_delete_button').click(function(e){

    e.preventDefault();
    var shortcut_arr = [];

        $('.shortcut_check').each(function() {
            if (jQuery(this).is(":checked")) {
                var id = this.id;
                shortcut_arr.push(id);
            }
        });
    // alert('todo_arr : '+ shortcut_arr)

    window.history.pushState("", "", '/wm/myshortcut/')

    option = prompt("삭제 하실래요(x,y)?", "");

    if(shortcut_arr != ""){
        if(option == "y"){
            $.ajax({
              type: "POST",
              url: 'delete/ajax/',
              data: {
                  'shortcut_arr[]':shortcut_arr,
                  csrfmiddlewaretoken: '{{ csrf_token }}'
              },
                success: function(result) {
                    alert('todo_delete_ajax is success ');
                    jQuery('input:checkbox:checked').parents("table").remove();
                }
            });

        } else {
            alert("삭제를 취소하셨습니다.")
        }
    } else {
        alert("체크 박스를 체크해주세요")
    }

})

$(".go_btn").click(function(){

    const number = $(".go_input").val();

    if(number == 1){
        $('html, body').animate({
            'scrollTop' : $("#index_first").offset().bottom
        });
    }
    $('html, body').animate({
        'scrollTop' : $("#index_"+number).offset().top
    });
})

$(".go_btn").click(function(e) {
         // Prevent a page reload when a link is pressed
       e.preventDefault();
         // Call the scroll function
       goToByScroll($(this).attr("id"));
   });

$(".user_list_btn").click(function(){
    const url ="userlist/byajax"
    window.history.pushState("", "", '/wm/')

    $.get(url)
        .done((result) => {
            // alert("유저 리스트")
            // console.log("result : " , result);
            $("#user_table_area").html(result)
            $("#user_list_modal").modal();

            window.history.pushState("", "", '/wm/myshortcut')

        })
        .fail(() => {
            console.log("fail");
        })
        .always(() => {
            console.log('always');
        })
})

// 2244
$('.category_name_list_button').click(function(e){
    const user_name =  $("#shortcut_user_id").val();
    const url = '/wm/myshorcut/nicklist/'+user_name
    const ch = $("#current_category").text()

    $.get(url)
        .done((result) => {
            console.log("result : " , result);
            $(".category_nick_area").html(result)
            $("#CategoryModal").modal();
            // alert("ch : " + ch)
            $("#"+ch).css("background-color", "skyblue");
        })
        .fail(() => {
            console.log("fail");
        })
        .always(() => {
            console.log('always');
        })
})

$('.update_shortcut_user_id').click(function(e){
    e.preventDefault();
    const id = this.id
    const user_id = $("#shortcut_user_id").val()

    // alert("유저 수정 클릭 2")
    // alert("user_id : "+ user_id)

    window.history.pushState("", "", '/wm/')

    $.ajax({
      type: "POST",
      url: 'update/shortcut_id_ajax/'+id,
      data: {
          'user_id':user_id,
          csrfmiddlewaretoken: '{{ csrf_token }}'
      },
        success: function(result) {
            alert("result.message : " + result.message)
            const original_id = result.original_id
            if(original_id !=""){
                $("#shortcut_user_id").val(original_id)
            }
            // alert(original_id)
            // alert("id 교체 실행")
            window.history.pushState("", "", '/wm/myshortcut/')
            location.href = "/wm/myshortcut/"
        }
    });
})

$('body').on('click', '.shortcut_edit_button1', function(e) {
    e.preventDefault();
    var id = $(this).attr("id");
    const content1 = $("#select-input-"+id).val();

    $.ajax({
      type: "POST",
      url: '/wm/myshortcut/update_shortcut1_ajax/'+id,
      data: {
          id:id,
          content1:content1,
          csrfmiddlewaretoken: '{{ csrf_token }}'
      },
        success: function(result) {
            alert("modify is completted")
        }
    });
});

$('body').on('click', '.shortcut_edit_button2', function(e) {
    e.preventDefault();
    var id = $(this).attr("id");
    // alert("id : " + id)
    var content2 = $("#select-textarea-"+id).val();
    // alert("content2_update : " , content2)

    // var content2 = content2_update
    // alert("content2 : "+ content2)

    $.ajax({
      type: "POST",
      url: '/wm/myshortcut/update_shortcut2_ajax/'+id,
      data: {
          id:id,
          content2:content2,
          csrfmiddlewaretoken: '{{ csrf_token }}'
      },
        success: function(result) {
            alert("modify is completted")
        }
    });
});

$('body').on('click', '.copy_code1', function(e) {

    e.preventDefault();
    var id = this.id

    document.execCommand('copy', false, $(this).parent().find('#select-input-'+id).select());
    alert("copy is completed")
});

$('body').on('click', '.copy_code2', function(e) {
    e.preventDefault();
    var id = this.id
    // alert(id)
    document.execCommand('copy', false, $(this).parent().find('#select-textarea-'+id).select());
    alert("copy is completed")
});

// 댓글 삭제 버튼
$('body').on('click', '.short_delete_button', function(e) {
    e.preventDefault();
    var id = $(this).attr("id");

    $.ajax({
      type: "POST",
      url: '/wm/myshortcut/delete_shortcut_ajax/'+id,
      data: {
          csrfmiddlewaretoken: '{{ csrf_token }}'
      },
        success: function(result) {
            $("#shortcut_"+id ).remove();
            $("#shortcut_"+id+"-2" ).remove();
            alert('comment 삭제 complete ');
        }
    });
});

// 댓글 수정 버튼
$('body').on('click', '.short_update_button', function(e) {
    e.preventDefault();
    const title = prompt("title을 입력해 주세요 ", "");

    if (!title) {
        return;
    };

    var id = $(this).attr("id");

    $.ajax({
      type: "POST",
      url: '/wm/myshortcut/update_shortcut_ajax/'+id,
      data: {
          title:title,
          csrfmiddlewaretoken: '{{ csrf_token }}'
      },
        success: function(result) {
            $("#title_"+id).text(result.title)
            alert(result.message);
        }
    });
});


{% endblock %}
</script>
