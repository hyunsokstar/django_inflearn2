{% extends "layout.html" %}
{%block title %}(pm)manual{% endblock %}
{%block extra_head %}
{% endblock %}
{%block content2%}

<div class="jumbotron">
    <h2>자유 게시판</h2>
</div>

{% if messages %}
<div class="alert alert-success">
    {% for message in messages %}
     {{ message.message }}<strong>{{ message.tags }}</strong>
     {% endfor %}
</div>
{% endif %}

<!-- <a href="/bestlec/new/" class="btn btn-danger float-right">입력 </a> -->

<br><br>
<a href = "{% url "pm:insert_manual" %}" class="btn btn-outline-info float-right">입력</a>

<br><br>


    <table class="table table-bordered" id="todo_list">
        <tr>
            <td>index</td>
            <td>title</td>
            <td>author</td>
            <td>created_at</td>
        </tr>
        {% if object_list.exists %}
        {% for p in object_list %}
        <tr>
            <td>
                {{ p.id }}
            </td>
            <td>
                <a href="{{p.get_absolute_url}}">
                    {{p.title}}
                    {% if p.author == request.user %}
                    <a href = "{% url "pm:delete_manual" p.id %}" class="badge badge-pill badge-info">삭제</a>
                    <a class="badge badge-pill badge-info" href="{% url "pm:edit_manual" p.id %}">수정</a>
                    {% endif %}

                </a>
            </td>
            <td>
                {{p.author}}
            </td>
            <td>
                {{p.created_at}}
            </td>
        </tr>
        {% endfor %}
        {% else %}
        <tr>
            <td colspan="4">
                <h4>아직 게시물이 없습니다.</h4>
            </td>
        </tr>
        {% endif %}
        <tbody id="post_list">
        </tbody>
    </table>


<!-- <a href="#" id="page-2-btn">2페이지 로딩</a> -->

{% endblock %}

<script type="text/javascript">
{% block extra_js %}

$(() => {
    //scroll을 구현해 보자
    $win = $(window);
    var is_loaded = false;
    var current_page;
    $win.scroll(() => {
        var diff = $(document).height() - $win.height();

        if((!is_loaded) && diff - $win.scrollTop() < 1 ) {
            console.log("현재 창의 위치는 바닥입니다.");
            var next_page = (current_page || 1) + 1;
            current_page = next_page
            var next_page_url = '?page=' + next_page;
            is_loaded = true;
            $.get(next_page_url).
                done(function(html) {
                    console.log("html(next) : ", html)
                    $("#post_list").append(html);
                    next_page = current_page +1
                    console.log("현재 페이지 번호 : ", current_page);
                }).
                fail(function(hxr, textStatus, error) {
                    console.log(textStatus);
                }).always(function() {
                    console.log("always");
                    is_loaded = false;
                });
            }
    });
});


{% endblock %}
</script>
